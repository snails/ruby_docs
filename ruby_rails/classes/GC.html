<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>GC</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Module</span> 
            GC 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/ruby-1_9_3-p194/gc_c.html">ruby-1.9.3-p194/gc.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>The <code>GC</code> module provides an interface to Rubyâ€™s mark and sweep
garbage collection mechanism. Some of the underlying methods are also
available via the <a href="ObjectSpace.html">ObjectSpace</a> module.</p>

<p>You may obtain information about the operation of the <a
href="GC.html">GC</a> through <a href="GC/Profiler.html">GC::Profiler</a>.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="GC/Profiler.html">GC::Profiler</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-allocated_size">allocated_size</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-clear_stats">clear_stats</a>,
              </li>
            
              
              <li>
                <a href="#method-c-collections">collections</a>,
              </li>
            
              
              <li>
                <a href="#method-c-count">count</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-disable">disable</a>,
              </li>
            
              
              <li>
                <a href="#method-c-disable_stats">disable_stats</a>,
              </li>
            
              
              <li>
                <a href="#method-c-disable_trace">disable_trace</a>,
              </li>
            
              
              <li>
                <a href="#method-c-dump">dump</a>,
              </li>
            
              
              <li>
                <a href="#method-c-dump_file_and_line_info">dump_file_and_line_info</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-enable">enable</a>,
              </li>
            
              
              <li>
                <a href="#method-c-enable_stats">enable_stats</a>,
              </li>
            
              
              <li>
                <a href="#method-c-enable_trace">enable_trace</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-garbage_collect">garbage_collect</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-heap_slots">heap_slots</a>,
              </li>
            
              
              <li>
                <a href="#method-c-heap_slots_live_after_last_gc">heap_slots_live_after_last_gc</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-log">log</a>,
              </li>
            
              
              <li>
                <a href="#method-c-log_file">log_file</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-malloc_allocated_size">malloc_allocated_size</a>,
              </li>
            
              
              <li>
                <a href="#method-c-malloc_allocations">malloc_allocations</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-num_allocations">num_allocations</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-start">start</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stat">stat</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stats_enabled-3F">stats_enabled?</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stress">stress</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stress-3D">stress=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-time">time</a>,
              </li>
            
              
              <li>
                <a href="#method-c-trace_enabled-3F">trace_enabled?</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">HEAP_SLOT_SIZE</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(sizeof(RVALUE))</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-allocated_size">
            
              <a name="method-c-allocated_size"></a><b>allocated_size</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-allocated_size_source')" id="l_method-c-allocated_size_source">show</a>
                
              </p>
              <div id="method-c-allocated_size_source" class="dyn-source">
                <pre>VALUE
rb_gc_allocated_size()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
#if HAVE_LONG_LONG
    return ULL2NUM(gc_allocated_size);
#else
    return ULONG2NUM(gc_allocated_size);
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-clear_stats">
            
              <a name="method-c-clear_stats"></a><b>GC.clear_stats    => nil
</b>
            
          </div>
          
          
            <div class="description">
              <p>Clears garbage collection statistics, returning nil. This resets the number
of collections (<a href="GC.html#method-c-collections">::collections</a>)
and the time used (<a href="GC.html#method-c-time">::time</a>) to 0.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">clear_stats</span>    <span class="ruby-comment">#=&gt; nil</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-clear_stats_source')" id="l_method-c-clear_stats_source">show</a>
                
              </p>
              <div id="method-c-clear_stats_source" class="dyn-source">
                <pre>VALUE
rb_gc_clear_stats()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    gc_collections = 0;
    gc_time_accumulator = 0;
    gc_time_accumulator_before_gc = 0;
    gc_allocated_size = 0;
    gc_num_allocations = 0;
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-collections">
            
              <a name="method-c-collections"></a><b>collections</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-collections_source')" id="l_method-c-collections_source">show</a>
                
              </p>
              <div id="method-c-collections_source" class="dyn-source">
                <pre>VALUE
rb_gc_collections()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return LONG2NUM(gc_collections);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-count">
            
              <a name="method-c-count"></a><b>GC.count &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>The number of times <a href="GC.html">GC</a> occurred.</p>

<p>It returns the number of times <a href="GC.html">GC</a> occurred since the
process started.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-count_source')" id="l_method-c-count_source">show</a>
                
              </p>
              <div id="method-c-count_source" class="dyn-source">
                <pre>static VALUE
gc_count(VALUE self)
{
    return UINT2NUM((&amp;rb_objspace)-&gt;count);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-disable">
            
              <a name="method-c-disable"></a><b>GC.disable    &rarr; true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Disables garbage collection, returning <code>true</code> if garbage
collection was already disabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable</span>   <span class="ruby-comment">#=&gt; false</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable</span>   <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-disable_source')" id="l_method-c-disable_source">show</a>
                
              </p>
              <div id="method-c-disable_source" class="dyn-source">
                <pre>VALUE
rb_gc_disable(void)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = dont_gc;

    dont_gc = TRUE;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-disable_stats">
            
              <a name="method-c-disable_stats"></a><b>GC.disable_stats    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Disables garbage collection statistics, returning <code>true</code> if
garbage collection statistics was already disabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable_stats</span>   <span class="ruby-comment">#=&gt; false or true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable_stats</span>   <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-disable_stats_source')" id="l_method-c-disable_stats_source">show</a>
                
              </p>
              <div id="method-c-disable_stats_source" class="dyn-source">
                <pre>VALUE
rb_gc_disable_stats()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = gc_statistics;
    gc_statistics = 0;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-disable_trace">
            
              <a name="method-c-disable_trace"></a><b>GC.disable_trace    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Disables garbage collection tracing, returning <code>true</code> if garbage
collection tracing was already disabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable_trace</span>   <span class="ruby-comment">#=&gt; false or true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable_trace</span>   <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-disable_trace_source')" id="l_method-c-disable_trace_source">show</a>
                
              </p>
              <div id="method-c-disable_trace_source" class="dyn-source">
                <pre>VALUE
rb_gc_disable_trace()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = verbose_gc_stats;
    verbose_gc_stats = 0;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-dump">
            
              <a name="method-c-dump"></a><b>GC.dump    => nil
</b>
            
          </div>
          
          
            <div class="description">
              <p>dumps information about the current <a href="GC.html">GC</a> data
structures to the <a href="GC.html">GC</a> log file</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">dump</span>    <span class="ruby-comment">#=&gt; nil</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-dump_source')" id="l_method-c-dump_source">show</a>
                
              </p>
              <div id="method-c-dump_source" class="dyn-source">
                <pre>VALUE
rb_gc_dump()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    size_t i;

    for (i = 0; i &lt; heaps_used; i++) {
        size_t limit = objspace-&gt;heap.sorted[i].slot-&gt;limit;
        fprintf(gc_data_file, &quot;HEAP[%2lu]: size=%7lu\n&quot;, (unsigned long)i, (unsigned long)limit);
    }

    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-dump_file_and_line_info">
            
              <a name="method-c-dump_file_and_line_info"></a><b>GC.dump_file_and_line_info(String, boolean)    => nil
</b>
            
          </div>
          
          
            <div class="description">
              <p>dumps information on which currently allocated object was created by which
file and on which line</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">dump_file_and_line_info</span>(<span class="ruby-constant">String</span>, <span class="ruby-identifier">boolean</span>)    <span class="ruby-comment">#=&gt; nil</span>
</pre>

<p>The second parameter specifies whether class names should be included in
the dump. Note that including class names will allocate additional string
objects on the heap.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-dump_file_and_line_info_source')" id="l_method-c-dump_file_and_line_info_source">show</a>
                
              </p>
              <div id="method-c-dump_file_and_line_info_source" class="dyn-source">
                <pre>VALUE
rb_gc_dump_file_and_line_info(int argc, VALUE *argv)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    VALUE filename, str, include_classnames = Qnil;
    char *fname = NULL;
    char *klass = NULL;
    FILE* f = NULL;
    size_t i = 0;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;filename, &amp;include_classnames);

    str = StringValue(filename);
    fname = RSTRING_PTR(str);
    f = fopen(fname, &quot;w&quot;);

    for (i = 0; i &lt; heaps_used; i++) {
        RVALUE *p, *pend;

        p = objspace-&gt;heap.sorted[i].start; pend = objspace-&gt;heap.sorted[i].end;
        for (;p &lt; pend; p++) {
            if (p-&gt;as.basic.flags) {
                const char *src_filename = (p-&gt;file &amp;&amp; p-&gt;file != Qnil )? RSTRING_PTR(p-&gt;file) : &quot;&quot;;
                fprintf(f, &quot;%s:%s:%d&quot;, obj_type(p-&gt;as.basic.flags &amp; T_MASK), src_filename, (int)p-&gt;line);
                // rb_obj_classname will create objects on the heap, we need a better solution
                if (include_classnames == Qtrue) {
                    /* write the class */
                    fprintf(f, &quot;:&quot;);
                    switch (BUILTIN_TYPE(p)) {
                    case T_NONE:
                        fprintf(f, &quot;__none__&quot;);
                        break;
                    case T_UNDEF:
                        fprintf(f, &quot;__undef__&quot;);
                        break;
                    case T_NODE:
                        fprintf(f, &quot;__node__&quot;);
                        break;
                    default:
                        if (!p-&gt;as.basic.klass) {
                            fprintf(f, &quot;__unknown__&quot;);
                        } else {
                            fprintf(f, &quot;%s&quot;, rb_obj_classname((VALUE)p));
                        }
                    }
                    /* print object size for some known object types */
                    switch (BUILTIN_TYPE(p)) {
                    case T_STRING:
                        fprintf(f, &quot;:%lu&quot;, RSTRING_LEN(p));
                        break;
                    case T_ARRAY:
                        fprintf(f, &quot;:%lu&quot;, RARRAY_LEN(p));
                        break;
                    case T_HASH:
                        fprintf(f, &quot;:%lu&quot;, (long unsigned int)RHASH_SIZE(p));
                        break;
                    }
                }
                fprintf(f, &quot;\n&quot;);
            }
        }
    }
    fclose(f);
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-enable">
            
              <a name="method-c-enable"></a><b>GC.enable    &rarr; true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Enables garbage collection, returning <code>true</code> if garbage
collection was previously disabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">disable</span>   <span class="ruby-comment">#=&gt; false</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable</span>    <span class="ruby-comment">#=&gt; true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable</span>    <span class="ruby-comment">#=&gt; false</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-enable_source')" id="l_method-c-enable_source">show</a>
                
              </p>
              <div id="method-c-enable_source" class="dyn-source">
                <pre>VALUE
rb_gc_enable(void)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = dont_gc;

    dont_gc = FALSE;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-enable_stats">
            
              <a name="method-c-enable_stats"></a><b>GC.enable_stats    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Enables garbage collection statistics, returning <code>true</code> if
garbage collection statistics was already enabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable_stats</span>   <span class="ruby-comment">#=&gt; false or true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable_stats</span>   <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-enable_stats_source')" id="l_method-c-enable_stats_source">show</a>
                
              </p>
              <div id="method-c-enable_stats_source" class="dyn-source">
                <pre>VALUE
rb_gc_enable_stats()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = gc_statistics;
    gc_statistics = 1;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-enable_trace">
            
              <a name="method-c-enable_trace"></a><b>GC.enable_trace    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Enables garbage collection tracing, returning <code>true</code> if garbage
collection tracing was already enabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable_trace</span>   <span class="ruby-comment">#=&gt; false or true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">enable_trace</span>   <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-enable_trace_source')" id="l_method-c-enable_trace_source">show</a>
                
              </p>
              <div id="method-c-enable_trace_source" class="dyn-source">
                <pre>VALUE
rb_gc_enable_trace()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int old = verbose_gc_stats;
    verbose_gc_stats = 1;
    return old ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-heap_slots">
            
              <a name="method-c-heap_slots"></a><b>GC.heap_slots    => Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>Returns the number of heap slots available for object allocations.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">heap_slots</span>    <span class="ruby-comment">#=&gt; 10000</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-heap_slots_source')" id="l_method-c-heap_slots_source">show</a>
                
              </p>
              <div id="method-c-heap_slots_source" class="dyn-source">
                <pre>VALUE
rb_gc_heap_slots()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return LONG2NUM(heap_size);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-heap_slots_live_after_last_gc">
            
              <a name="method-c-heap_slots_live_after_last_gc"></a><b>GC.heap_slots_live_after_last_gc    => Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>Returns the number of heap slots which were live after the last garbage
collection.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">heap_slots_live_after_last_gc</span>    <span class="ruby-comment">#=&gt; 231223</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-heap_slots_live_after_last_gc_source')" id="l_method-c-heap_slots_live_after_last_gc_source">show</a>
                
              </p>
              <div id="method-c-heap_slots_live_after_last_gc_source" class="dyn-source">
                <pre>VALUE
rb_gc_heap_slots_live_after_last_gc()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return ULONG2NUM(heap_slots_live_after_last_gc);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-log">
            
              <a name="method-c-log"></a><b>GC.log String  => String
</b>
            
          </div>
          
          
            <div class="description">
              <p>Logs string to the <a href="GC.html">GC</a> data file and returns it.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">log</span> <span class="ruby-string">&quot;manual GC call&quot;</span>    <span class="ruby-comment">#=&gt; &quot;manual GC call&quot;</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-log_source')" id="l_method-c-log_source">show</a>
                
              </p>
              <div id="method-c-log_source" class="dyn-source">
                <pre>VALUE
rb_gc_log(self, original_str)
     VALUE self, original_str;
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    if (original_str == Qnil) {
        fprintf(gc_data_file, &quot;\n&quot;);
    }
    else {
        VALUE str = StringValue(original_str);
        char *p = RSTRING_PTR(str);
        fprintf(gc_data_file, &quot;%s\n&quot;, p);
    }
    return original_str;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-log_file">
            
              <a name="method-c-log_file"></a><b>GC.log_file(filename=nil, mode="w")    => boolean
</b>
            
          </div>
          
          
            <div class="description">
              <p>Changes the <a href="GC.html">GC</a> data log file. Closes the currently
open logfile. Returns true if the file was successfully opened for writing.
Returns false if the file could not be opened for writing. Returns the name
of the current logfile (or nil) if no parameter is given. Restores logging
to stderr when given nil as an argument.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">log_file</span>                  <span class="ruby-comment">#=&gt; nil</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">log_file</span> <span class="ruby-string">&quot;/tmp/gc.log&quot;</span>    <span class="ruby-comment">#=&gt; true</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">log_file</span>                  <span class="ruby-comment">#=&gt; &quot;/tmp/gc.log&quot;</span>
<span class="ruby-constant">GC</span>.<span class="ruby-identifier">log_file</span> <span class="ruby-keyword">nil</span>              <span class="ruby-comment">#=&gt; true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-log_file_source')" id="l_method-c-log_file_source">show</a>
                
              </p>
              <div id="method-c-log_file_source" class="dyn-source">
                <pre>VALUE
rb_gc_log_file(int argc, VALUE *argv, VALUE self)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    VALUE filename = Qnil;
    VALUE mode_str = Qnil;
    FILE* f = NULL;
    const char* mode = &quot;w&quot;;

    VALUE current_logfile_name = rb_iv_get(rb_mGC, GC_LOGFILE_IVAR);

    if (argc==0)
        return current_logfile_name;

    rb_scan_args(argc, argv, &quot;02&quot;, &amp;filename, &amp;mode_str);

    if (filename == Qnil) {
        /* close current logfile and reset logfile to stderr */
        if (gc_data_file != stderr) {
            fclose(gc_data_file);
            gc_data_file = stderr;
            rb_iv_set(rb_mGC, GC_LOGFILE_IVAR, Qnil);
        }
        return Qtrue;
    }

    /* we have a real logfile name */
    filename = StringValue(filename);

    if (rb_equal(current_logfile_name, filename) == Qtrue) {
        /* do nothing if we get the file name we're already logging to */
        return Qtrue;
    }

    /* get mode for file opening */
    if (mode_str != Qnil)
    {
      mode = RSTRING_PTR(StringValue(mode_str));
    }

    /* try to open file in given mode */
    if (f = fopen(RSTRING_PTR(filename), mode)) {
        if (gc_data_file != stderr) {
            fclose(gc_data_file);
        }
        gc_data_file = f;
        rb_iv_set(rb_mGC, GC_LOGFILE_IVAR, filename);
    } else {
        return Qfalse;
    }
    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-malloc_allocated_size">
            
              <a name="method-c-malloc_allocated_size"></a><b>GC.malloc_allocated_size &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>The allocated size by malloc().</p>

<p>It returns the allocated size by malloc().</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-malloc_allocated_size_source')" id="l_method-c-malloc_allocated_size_source">show</a>
                
              </p>
              <div id="method-c-malloc_allocated_size_source" class="dyn-source">
                <pre>static VALUE
gc_malloc_allocated_size(VALUE self)
{
    return UINT2NUM((&amp;rb_objspace)-&gt;malloc_params.allocated_size);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-malloc_allocations">
            
              <a name="method-c-malloc_allocations"></a><b>GC.malloc_allocations &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>The number of allocated memory object by malloc().</p>

<p>It returns the number of allocated memory object by malloc().</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-malloc_allocations_source')" id="l_method-c-malloc_allocations_source">show</a>
                
              </p>
              <div id="method-c-malloc_allocations_source" class="dyn-source">
                <pre>static VALUE
gc_malloc_allocations(VALUE self)
{
    return UINT2NUM((&amp;rb_objspace)-&gt;malloc_params.allocations);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-num_allocations">
            
              <a name="method-c-num_allocations"></a><b>num_allocations</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-num_allocations_source')" id="l_method-c-num_allocations_source">show</a>
                
              </p>
              <div id="method-c-num_allocations_source" class="dyn-source">
                <pre>VALUE
rb_gc_num_allocations()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
#if HAVE_LONG_LONG
    return ULL2NUM(gc_num_allocations);
#else
    return ULONG2NUM(gc_num_allocations);
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-start">
            
              <a name="method-c-start"></a><b>GC.start                     &rarr; nil
gc.garbage_collect           &rarr; nil
ObjectSpace.garbage_collect  &rarr; nil
</b>
            
          </div>
          
          
            <div class="description">
              <p>Initiates garbage collection, unless manually disabled.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-start_source')" id="l_method-c-start_source">show</a>
                
              </p>
              <div id="method-c-start_source" class="dyn-source">
                <pre>VALUE
rb_gc_start(void)
{
    rb_gc();
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stat">
            
              <a name="method-c-stat"></a><b>GC.stat &rarr; Hash
</b>
            
          </div>
          
          
            <div class="description">
              <p>Returns a <a href="Hash.html">Hash</a> containing information about the <a
href="GC.html">GC</a>.</p>

<p>The hash includes information about internal statistics about <a
href="GC.html">GC</a> such as:</p>

<pre class="ruby">{
  :<span class="ruby-identifier">count</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-value">18</span>,
  :<span class="ruby-identifier">heap_used</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value">77</span>,
  :<span class="ruby-identifier">heap_length</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value">77</span>,
  :<span class="ruby-identifier">heap_increment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
  :<span class="ruby-identifier">heap_live_num</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">23287</span>,
  :<span class="ruby-identifier">heap_free_num</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">8115</span>,
  :<span class="ruby-identifier">heap_final_num</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
}
</pre>

<p>The contents of the hash are implementation defined and may be changed in
the future.</p>

<p>This method is only expected to work on C Ruby.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stat_source')" id="l_method-c-stat_source">show</a>
                
              </p>
              <div id="method-c-stat_source" class="dyn-source">
                <pre>static VALUE
gc_stat(int argc, VALUE *argv, VALUE self)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    VALUE hash;

    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;hash) == 1) {
        if (TYPE(hash) != T_HASH)
            rb_raise(rb_eTypeError, &quot;non-hash given&quot;);
    }

    if (hash == Qnil) {
        hash = rb_hash_new();
    }

    rest_sweep(objspace);

    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;count&quot;)), SIZET2NUM(objspace-&gt;count));

    /* implementation dependent counters */
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_used&quot;)), SIZET2NUM(objspace-&gt;heap.used));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_length&quot;)), SIZET2NUM(objspace-&gt;heap.length));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_increment&quot;)), SIZET2NUM(objspace-&gt;heap.increment));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_live_num&quot;)), SIZET2NUM(objspace-&gt;heap.live_num));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_free_num&quot;)), SIZET2NUM(objspace-&gt;heap.free_num));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;heap_final_num&quot;)), SIZET2NUM(objspace-&gt;heap.final_num));
    return hash;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stats_enabled-3F">
            
              <a name="method-c-stats_enabled-3F"></a><b>GC.stats_enabled?    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Check whether <a href="GC.html">GC</a> stats have been enabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">stats_enabled?</span>   <span class="ruby-comment">#=&gt; false or true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stats_enabled-3F_source')" id="l_method-c-stats_enabled-3F_source">show</a>
                
              </p>
              <div id="method-c-stats_enabled-3F_source" class="dyn-source">
                <pre>VALUE
rb_gc_stats_enabled()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return gc_statistics ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stress">
            
              <a name="method-c-stress"></a><b>GC.stress                 &rarr; true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>returns current status of <a href="GC.html">GC</a> stress mode.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stress_source')" id="l_method-c-stress_source">show</a>
                
              </p>
              <div id="method-c-stress_source" class="dyn-source">
                <pre>static VALUE
gc_stress_get(VALUE self)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return ruby_gc_stress ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stress-3D">
            
              <a name="method-c-stress-3D"></a><b>GC.stress = bool          &rarr; bool
</b>
            
          </div>
          
          
            <div class="description">
              <p>Updates the <a href="GC.html">GC</a> stress mode.</p>

<p>When stress mode is enabled the <a href="GC.html">GC</a> is invoked at
every <a href="GC.html">GC</a> opportunity: all memory and object
allocations.</p>

<p>Enabling stress mode makes Ruby very slow, it is only for debugging.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stress-3D_source')" id="l_method-c-stress-3D_source">show</a>
                
              </p>
              <div id="method-c-stress-3D_source" class="dyn-source">
                <pre>static VALUE
gc_stress_set(VALUE self, VALUE flag)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    rb_secure(2);
    ruby_gc_stress = RTEST(flag);
    return flag;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-time">
            
              <a name="method-c-time"></a><b>time</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-time_source')" id="l_method-c-time_source">show</a>
                
              </p>
              <div id="method-c-time_source" class="dyn-source">
                <pre>VALUE
rb_gc_time()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
#if HAVE_LONG_LONG
    return LL2NUM(gc_time_accumulator);
#else
    return LONG2NUM(gc_time_accumulator);
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-trace_enabled-3F">
            
              <a name="method-c-trace_enabled-3F"></a><b>GC.trace_enabled?    => true or false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Check whether <a href="GC.html">GC</a> tracing has been enabled.</p>

<pre class="ruby"><span class="ruby-constant">GC</span>.<span class="ruby-identifier">trace_enabled?</span>   <span class="ruby-comment">#=&gt; false or true</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-trace_enabled-3F_source')" id="l_method-c-trace_enabled-3F_source">show</a>
                
              </p>
              <div id="method-c-trace_enabled-3F_source" class="dyn-source">
                <pre>VALUE
rb_gc_trace_enabled()
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    return verbose_gc_stats ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-garbage_collect">
            
              <a name="method-i-garbage_collect"></a><b>GC.start                     &rarr; nil
gc.garbage_collect           &rarr; nil
ObjectSpace.garbage_collect  &rarr; nil
</b>
            
          </div>
          
          
            <div class="description">
              <p>Initiates garbage collection, unless manually disabled.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-garbage_collect_source')" id="l_method-i-garbage_collect_source">show</a>
                
              </p>
              <div id="method-i-garbage_collect_source" class="dyn-source">
                <pre>VALUE
rb_gc_start(void)
{
    rb_gc();
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    